server:
  port: 8083
  address: 0.0.0.0

spring:
  application:
    name: enrollment-service
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
  cloud:
    nacos:
      discovery:
        server-addr: ${SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR:localhost:8848}
        namespace: public
        group: DEFAULT_GROUP
        ephemeral: true
        heartbeat-interval: 5000
        heartbeat-timeout: 15000
    loadbalancer:
      retry:
        enabled: false          # 由 Resilience4j 负责重试，这里关闭 Spring Retry 冲突
    openfeign:
      client:
        config:
          default:              # 全局默认，对所有 Feign 客户端生效
            connectTimeout: 3000      # 3 秒
            readTimeout: 5000         # 5 秒
            retryer: feign.Retryer.Default   # 关闭 Feign 自带重试，立即失败立即熔断

feign:
  circuitbreaker:
    enabled: true                 # 启用熔断器

# Resilience4j 熔断器参数（按作业要求）
resilience4j:
  circuitbreaker:
    instances:
      user-service:               # 与 @FeignClient(name = "user-service") 保持一致
        failureRateThreshold: 50  # 50%
        slidingWindowSize: 10     # 最近 10 次调用
        minimumNumberOfCalls: 10  # 达到 10 次才开始统计
        recordExceptions:         # 以下异常都视为失败
          - java.net.ConnectException
          - java.net.SocketTimeoutException
          - java.io.IOException
          - feign.FeignException
          - java.lang.IllegalStateException
          
      catalog-service:            # 与 @FeignClient(name = "catalog-service") 保持一致
        failureRateThreshold: 50
        slidingWindowSize: 10
        minimumNumberOfCalls: 10
        recordExceptions:
          - java.net.ConnectException
          - java.net.SocketTimeoutException
          - java.io.IOException
          - feign.FeignException

logging:
  level:
    root: INFO
    com.zjsu.lyy.course.client: DEBUG   # 可选：看 Feign 调用日志